# windows账户与权限体系

## 简介

Windows提供了非常细致的权限控制页，能够精确定制用户对资源的访问控制能力，大多数的权限从字面上就能基本了解所能实现的内容。

“权限”（Permission）必须针对资源【文件、目录、注册表等】而言的。权限只能是以资源为对象，而不能是以用户为主，即“设置某个用户可以对哪些资源有权限”。

“权力”（Right）只要是针对用户而言。其通常包含“登录权力”（Logon Right）和“特权”（Privilege）两种。登录权力决定了用户如何登录到计算机【是否再用本地交互式登录、是否为网络登录等】；特权则是一系列权力的总称，主要用于帮助用户对系统进行管理【如：是否允许用户安装或加载驱动程序等】。

## 账户名与SID

Windows操作系统不是以“用户名称/账户名”来进行身份识别，而是通过SID对用户进行识别的。SID可应用于系统内的所有用户、组、服务或计算机，正因为SID具有唯一性，所以在删除了一个账户后，再次创建这个账户，即便用户名相同但SID也是不同的。所以又回到了之前的问题上，windows的SID理解与学习。

## SID与访问令牌  

用户通过验证后，登陆进程会给用户一个访问令牌，该令牌相当于用户访问系统资源的票证，当用户试图访问系统资源时，将访问令牌提供给Windows，然后Windows检查用户试图访问对象上的访问控制列表。如果用户被允许访问该对象，Windows将会分配给用户适当的访问权限。  访问令牌是用户在通过验证的时候由登陆进程所提供的，所以改变用户的权限需要注销后重新登陆，重新获取访问令牌。

值得注意的是，在进行数据分析时，我们经常遇到的就是服务SID，所谓服务SID，其目的是允许管理单个服务的权限，而无需创建服务账户。  用于隔离服务的一项功能，是自Vista和Windows Server 2008以后引入的安全功能。具有“不受限制”的SID类型属性的任何服务，都将具有添加到服务主机进程的访问令牌的特定服务SID。

形式：S-1-5-80-{大写服务名称的SHA-1值}  

例：sc showsid dnscache  

NAME: dnscache  

SERVICE SID: S-1-5-80-859482183-879914841-863379149-1145462774-2388618682  

STATUS: Active  又称为：NT SERVICE\ 【此处：NT SERVICE\】

## 访问控制列表（ACL）  

ACL是权限的核心技术，用于定义特定用户对某个资源的访问权限，简而言之就是对资源进行保护时所使用的一个标准列表。  在访问控制列表中，每一个用户或用户组都对应一组访问控制项（ACE），这一点只需在"组或用户名称"列表中选择不同的用户或组时，通过下方的权限列表设置项是不同的这一点就可以看出来。显然，所有用户或用户组的权限访问设置都将会在这里被存储下来，并允许随时被有权限进行修改的用户进行调整，如取消某个用户对某个资源的"写入"权限。

## 安全主体SP（Security Principal）  

在Windows系统中，可以将用户、用户组、计算机或服务都看成是一个安全主体，每个安全主体都拥有相对应的账户名称和SID。根据系统架构的不同，账户的管理方式也有所不同──本地账户被本地的SAM管理；域的账户则会被活动目录进行管理。  一般来说，权限的指派过程实际上就是为某个资源指定安全主体（即用户、用户组等）可以拥有怎样的操作过程。因为用户组包括多个用户，所以大多数情况下，为资源指派权限时建议使用用户组来完成，这样可以非常方便地完成统一管理。

## 网络服务账户

NetworkService帐户是服务控制管理器使用的预定义本地帐户。安全子系统无法识别此帐户，因此您无法在调用LookupAccountName函数时指定其名称。它在本地计算机上具有最低权限，并充当网络上的计算机。无论语言环境如何，该帐户的名称必须是NT AUTHORITY \ NetworkService ，否则可能会发生意外结果。

在NetworkService帐户的上下文中运行的服务将计算机的凭据提供给远程服务器。

## 本地服务账户

LocalService帐户是服务控制管理器使用的预定义本地帐户。安全子系统无法识别此帐户，因此您无法在调用LookupAccountName函数时指定其名称。它在本地计算机上具有最低权限，并在网络上显示匿名凭据。

可以在调用CreateService和ChangeServiceConfig函数时指定此帐户。请注意，此帐户没有密码，因此忽略您在此调用中提供的任何密码信息。安全子系统本地化此帐户名称时，SCM不支持本地化名称。因此，您将从LookupAccountSid函数接收此帐户的本地化名称，但是当您调用CreateService或ChangeServiceConfig时，无论语言环境如何，该帐户的名称都必须是NT AUTHORITY \ LocalService ，否则可能会出现意外结果。

## 本地系统账户

LocalSystem帐户是服务控制管理器使用的预定义本地帐户。安全子系统无法识别此帐户，因此您无法在调用LookupAccountName函数时指定其名称。它在本地计算机上具有广泛的权限，并充当网络上的计算机。它的令牌包括NT AUTHORITY \ SYSTEM和BUILTIN \ Administrators SID; 这些帐户可以访问大多数系统对象。所有语言环境中的帐户名称为\ LocalSystem。也可以使用名称LocalSystem或*ComputerName* \ LocalSystem。此帐户没有密码。如果在对CreateService或ChangeServiceConfig的调用中指定LocalSystem帐户功能，您提供的任何密码信息都将被忽略。

## 易受攻击的账户

攻击者可能使用的帐户可分为三类：默认帐户，本地帐户和域帐户。默认帐户是内置到操作系统中的帐户，例如Windows系统上的访客或管理员帐户或其他类型的系统，软件或设备上的默认服务/提供商帐户。本地帐户是由组织配置以供用户，远程支持，服务或单个系统或服务上的管理使用的帐户。域帐户是由Active Directory域服务管理的帐户，其中访问和权限是跨该域的一部分的系统和服务配置的。域帐户可以涵盖用户，管理员和服务。

## 思考

网络服务账户、本地服务账户、本地系统账户、是否可以基于账户名称或者SID作为一个筛选条件，对模型告警进行优化设计？

## 参考链接

<https://www.bilibili.com/read/cv2413272/>    Windows账户体系与权限之间的关系

<https://docs.microsoft.com/zh-cn/windows/security/identity-protection/access-control/local-accounts>    windows本地账户

<https://docs.microsoft.com/zh-cn/windows/win32/services/networkservice-account>  windows账户介绍
